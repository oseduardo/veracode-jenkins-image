//boolean flagBuildSuccess = false

//@Library("veracodeGlobalSharedLibrary") _
pipeline {

    agent any

    /*environment {
        vID     = credentials('VID')
        vKEY     = credentials('VKEY')
        SRCCLR_API_TOKEN = credentials('SRCCLR_API_TOKEN')
        product_name = 'Portal Pagos' // Custom Field - This value comes up from repo
        product_id = 'ppag' // Custom Field - This value comes up from repo
        appProfileName = '' // This variable is instantiated in stage 'Setting Up Veracode Base Components'
        wkspSiteId = '' // This variable is instantiated in stage 'Setting Up Veracode Base Components'
    }*/

    triggers {
        GenericTrigger(
            genericHeaderVariables: [
                [key: 'X-GitHub-Event', regexpFilter: '']
            ],
            genericVariables: [
                [key: 'ref', value: '$.ref'],
                [key: 'action', value: '$.action', defaultValue: 'null']
            ],
            
            causeString: 'Triggered on $ref',

            token: 'mytoken123',
            tokenCredentialId: '',
            
            printContributedVariables: true,
            printPostContent: true,
        )
    }

    stages {
        stage('Veracode Security Scans'){
            agent any
/*            agent {
                docker { 
                    //It uses veracode-agente:latest docker image to run pipeline stages
                    image 'veracode-agente:latest'
                    args '-e VERACODE_API_KEY_ID=$vID -e VERACODE_API_KEY_SECRET=$vKEY'
                    reuseNode true
                }
            }*/
            steps {
                script {
                    try {
                        echo "[INFO] Starting......"
                        sh 'ls -all /home/luser'
                    }
                    catch (Exception e) {
                        unstable("Process failed!")
                        currentBuild.result = 'FAILURE'
                    }
                }
            }
        }
    }
}