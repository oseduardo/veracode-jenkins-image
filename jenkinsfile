//boolean flagBuildSuccess = false

//@Library("veracodeGlobalSharedLibrary") _
pipeline {

    agent {
        docker { 
            //It uses veracode-agente:latest docker image to run pipeline stages
            image 'veracode-agente:latest'
            args '-e VERACODE_API_KEY_ID=$vID -e VERACODE_API_KEY_SECRET=$vKEY -i --entrypoint='
            reuseNode true
        }
    }

    /*environment {
        vID     = credentials('VID')
        vKEY     = credentials('VKEY')
        SRCCLR_API_TOKEN = credentials('SRCCLR_API_TOKEN')
        product_name = 'Portal Pagos' // Custom Field - This value comes up from repo
        product_id = 'ppag' // Custom Field - This value comes up from repo
        appProfileName = '' // This variable is instantiated in stage 'Setting Up Veracode Base Components'
        wkspSiteId = '' // This variable is instantiated in stage 'Setting Up Veracode Base Components'
    }*/

    triggers {
        GenericTrigger(
            genericHeaderVariables: [
                [key: 'X-GitHub-Event', regexpFilter: '']
            ],
            genericVariables: [
                [key: 'ref', value: '$.ref'],
                [key: 'action', value: '$.action', defaultValue: 'null']
            ],
            
            causeString: 'Triggered on $ref',

            token: 'mytoken123',
            tokenCredentialId: '',
            
            printContributedVariables: true,
            printPostContent: true,
        )
    }

    stages {
        stage('Prueba'){


            steps{
                script{
                    echo "[INFO] Setting up Veracode Credentials File..."
                    //sh "ls -all ${HOME}"
                    //sh "chmod +x -R ${HOME}"
                    //sh "mkdir -p ${HOME}/.veracode"
                    //sh "echo 'pruebita'"
                    //sh "ls -all ${HOME}"
                    //sh 'cat'
                    //sh 'pwd'
                    echo "Prueba..."
                }
            }
        }
    }

/*    stage('Veracode Security Scans'){
        agent any*/
/*            agent {
                docker { 
                    //It uses veracode-agente:latest docker image to run pipeline stages
                    image 'veracode-agente:latest'
                    args '-e VERACODE_API_KEY_ID=$vID -e VERACODE_API_KEY_SECRET=$vKEY'
                    reuseNode true
                }
            }*/
/*        stages{
            steps {
                stage('Docker Image Validation'){
                    script {
                        try {
                            echo "[INFO] Starting......"
                            sh 'ls -all /home/luser'                            
                        }
                        catch (Exception e) {
                            unstable("Process failed!")
                            currentBuild.result = 'FAILURE'
                        }
                    }
                }
            }
        }
    }*/
}